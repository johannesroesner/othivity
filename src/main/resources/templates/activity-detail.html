<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:insert="~{layout/head :: head(#{activityDetail.pageTitle})}"></head>
<body class="flex flex-col min-h-screen">
<nav th:insert="~{layout/nav :: nav(activeTab='activities')}"></nav>
<div class="container mx-auto px-6 py-8 grow">
    <!-- content start -->

    <div class="flex items-center mb-6 space-x-2">
        <a href="/activities" class="btn btn-ghost btn-xl">‚Üê</a>
        <h1 class="text-3xl font-bold" th:text="#{activityDetail.pageTitle}"></h1>

        <!-- Buttons rechts in der gleichen Zeile -->
        <div class="ml-auto flex gap-4">
            <!-- Edit Button, nur sichtbar wenn editMode -->
            <a th:if="${editMode}" th:href="@{'/activities/edit/' + ${activity.id}}" class="btn btn-primary">
                Edit
            </a>

            <!-- Delete Button, nur sichtbar wenn editMode -->
            <form th:if="${editMode}" th:action="@{'/activities/delete/' + ${activity.id}}" method="post" onsubmit="return confirm('Are you sure you want to delete this activity?');">
                <button type="submit" class="btn btn-error">Delete</button>
            </form>

            <!-- Join Button, nur sichtbar wenn joinAble -->
            <form th:if="${joinAble}" th:action="@{'/activities/join/' + ${activity.id}}" method="post">
                <button type="submit" class="btn btn-success">Join</button>
            </form>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

        <div class="flex flex-col items-center lg:col-span-1 w-full">
            <!-- Carousel -->
            <div class="carousel w-full h-64 shadow-2xl relative overflow-hidden">
                <div th:each="img, i : ${images}" th:id="'slide-' + ${i.index}"
                     class="carousel-item w-full h-full absolute top-0 left-0 transition-opacity duration-500"
                     th:classappend="${i.index == 0} ? 'opacity-100 z-10' : 'opacity-0 z-0'">
                    <img th:src="@{${img.url}}" class="w-full h-full object-cover rounded-box"/>

                    <!-- Pfeile -->
                    <button type="button"
                            class="absolute left-2 top-1/2 transform -translate-y-1/2 btn btn-circle"
                            th:onclick="'prevSlide()'">‚ùÆ</button>
                    <button type="button"
                            class="absolute right-2 top-1/2 transform -translate-y-1/2 btn btn-circle"
                            th:onclick="'nextSlide()'">‚ùØ</button>
                </div>
            </div>

            <!-- Teilnehmer Block -->
            <div class="w-full bg-base-200 shadow-2xl p-6 rounded-2xl mt-4 flex-1 flex flex-col">
                <p class="text-sm font-semibold text-base-content/70 mb-2">Teilnehmer</p>

                <!-- Starter -->
                <div class="p-4 rounded-xl shadow-sm flex items-center gap-3 mb-2 border-l-4 border-primary">
                    <span th:if="${activity.startedBy.profileImageUrl == null}" class="w-8 h-8 rounded-full bg-gray-400 flex items-center justify-center text-white text-sm font-medium" th:text="${activity.startedBy.initials}"></span>
                    <img th:if="${activity.startedBy.profileImageUrl != null}" th:src="${activity.startedBy.profileImageUrl}" alt="Avatar" class="w-8 h-8 rounded-full object-cover ring-2 ring-primary"/>
                    <div class="flex flex-col">
                        <span class="text-xs text-gray-500">Starter</span>
                        <a th:href="@{'/profile/' + ${activity.startedBy.username}}" class="text-sm font-medium hover:underline" th:text="${activity.startedBy.username}"></a>
                    </div>
                </div>

                <!-- Teilnehmer -->
                <div class="flex-1 overflow-y-auto space-y-2" style="max-height: 300px;">
                    <div th:each="person : ${activity.takePart}" th:if="${person.username != activity.startedBy.username}" class="bg-white p-4 rounded-xl shadow-sm flex items-center gap-3">
                        <span th:if="${person.profileImageUrl == null}" class="w-8 h-8 rounded-full bg-gray-400 flex items-center justify-center text-white text-sm font-medium" th:text="${person.initials}"></span>
                        <img th:if="${person.profileImageUrl != null}" th:src="${person.profileImageUrl}" alt="Avatar" class="w-8 h-8 rounded-full object-cover"/>
                        <div class="flex flex-col">
                            <span class="text-xs text-gray-500">Teilnehmer</span>
                            <a th:href="@{'/profile/' + ${person.username}}" class="text-sm font-medium hover:underline" th:text="${person.username}"></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="lg:col-span-2">
            <div class="card bg-base-200 shadow-2xl p-8 space-y-8 rounded-2xl">

                <div class="flex items-center gap-2">
                    <span class="text-2xl">‚ÑπÔ∏è</span>
                    <h2 class="text-2xl font-bold" th:text="#{activityDetail.pageTitle}"></h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

                    <div class="space-y-1">
                        <p class="text-sm font-semibold text-base-content/70" th:text="#{activityCreate.title}"></p>
                        <div class="bg-base-100 p-4 rounded-xl shadow-sm">
                            <span class="text-base font-medium" th:text="${activity.title}"></span>
                        </div>
                    </div>

                    <div class="space-y-1">
                        <p class="text-sm font-semibold text-base-content/70" th:text="#{activityCreate.groupSize}"></p>
                        <div class="bg-base-100 p-4 rounded-xl shadow-sm">
                            <span class="text-base font-medium" th:text="${activity.participantStatus}"></span>
                        </div>
                    </div>
                </div>

                <div class="space-y-1">
                    <p class="text-sm font-semibold text-base-content/70" th:text="#{activityCreate.description}"></p>
                    <div class="bg-base-100 p-4 rounded-xl shadow-sm">
                        <span th:text="${activity.description}"></span>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-1">
                        <p class="text-sm font-semibold text-base-content/70" th:text="#{activityCreate.date}"></p>
                        <div class="bg-base-100 p-4 rounded-xl shadow-sm">
                            <span class="text-base font-medium" th:text="${#temporals.format(activity.date, 'dd.MM.yyyy')}"></span>
                        </div>
                    </div>
                    <div class="space-y-1">
                        <p class="text-sm font-semibold text-base-content/70" th:text="#{activityCreate.time}"></p>
                        <div class="bg-base-100 p-4 rounded-xl shadow-sm">
                            <span class="text-base font-medium" th:text="${#temporals.format(activity.date, 'HH:mm')}"></span>
                        </div>
                    </div>
                </div>

                <div class="space-y-1">
                    <p class="text-sm font-semibold text-base-content/70" th:text="#{activityCreate.language}"></p>
                    <div class="bg-base-100 p-4 rounded-xl shadow-sm flex items-center gap-2 text-lg">
                        <span th:text="${activity.language.emoji}"></span>
                        <span th:text="${activity.language.name}"></span>
                    </div>
                </div>

                <div class="space-y-1" th:if="${!#lists.isEmpty(activity.tags)}">
                    <p class="text-sm font-semibold text-base-content/70" th:text="#{activityCreate.tags}"></p>
                    <div class="bg-base-100 p-4 rounded-xl shadow-sm flex flex-wrap gap-2 items-center text-lg">
                        <span th:each="tag : ${activity.tags}">
                            <span class="flex items-center gap-1">
                                <span th:text="${tag.emoji}"></span>
                                <span th:text="#{${tag.key}}"></span>
                             </span>
                        </span>
                    </div>
                </div>

            </div>
        </div>

        <div class="bg-base-200 lg:col-span-2 shadow-2xl h-full rounded-2xl flex items-center justify-center text-6xl">
            ‚òÄÔ∏è
        </div>

        <div class="">
            <div class="card bg-base-200 shadow-2xl p-8 space-y-8 rounded-2xl">
                <div class="flex items-center gap-2">
                    <span class="text-2xl">üìç</span>
                    <h2 class="text-2xl font-bold">address</h2>
                </div>

                <div class="space-y-1">
                    <!-- Addition nur anzeigen, wenn vorhanden und nicht leer -->
                    <div th:if="!${#strings.isEmpty(activity.address.addition)}"
                         class="bg-base-100 p-4 rounded-xl shadow-sm">
                        <span class="text-base font-medium" th:text="${activity.address.addition}"></span>
                    </div>

                    <!-- Street + HouseNumber immer anzeigen -->
                    <div class="bg-base-100 p-4 rounded-xl shadow-sm">
                <span class="text-base font-medium"
                      th:text="${activity.address.street} + ' ' + ${activity.address.houseNumber}"></span>
                    </div>

                    <!-- PostalCode + City immer anzeigen -->
                    <div class="bg-base-100 p-4 rounded-xl shadow-sm">
                        <span class="text-base font-medium" th:text="${activity.address.postalCode} + ' ' + ${activity.address.city}"></span>
                    </div>

                    <!-- Country nur anzeigen, wenn vorhanden und nicht leer -->
                    <div th:if="!${#strings.isEmpty(activity.address.country)}"
                         class="bg-base-100 p-4 rounded-xl shadow-sm">
                        <span class="text-base font-medium" th:text="${activity.address.country}"></span>
                    </div>

                </div>
            </div>
        </div>

        <div class="lg:col-span-3 min-h-[300px]">
            <div th:replace="~{fragments/map :: mapDiv}"></div>
            <script th:replace="~{fragments/map :: mapScript(${activity.address.latitude}, ${activity.address.longitude}, ${activity.title})}"></script>
        </div>

    </div>
    </form>
    <!-- content end -->
</div>
<footer th:insert="~{layout/footer :: footer}"></footer>
<script>
    const slides = document.querySelectorAll('.carousel-item');
    let currentIndex = 0;

    function showSlide(index) {
        currentIndex = index;
        slides.forEach((slide, i) => {
            if(i === index){
                slide.classList.add('opacity-100', 'z-10');
                slide.classList.remove('opacity-0', 'z-0');
            } else {
                slide.classList.add('opacity-0', 'z-0');
                slide.classList.remove('opacity-100', 'z-10');
            }
        });
    }

    function prevSlide() {
        let newIndex = currentIndex - 1;
        if(newIndex < 0) newIndex = slides.length - 1;
        showSlide(newIndex);
    }

    function nextSlide() {
        let newIndex = currentIndex + 1;
        if(newIndex >= slides.length) newIndex = 0;
        showSlide(newIndex);
    }
</script>
</body>
</html>
