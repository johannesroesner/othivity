<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:data-theme="${currentThemeName}">
<head th:insert="~{layout/head :: head(#{activityDetail.pageTitle})}"></head>
<body class="flex flex-col min-h-screen">
<nav th:insert="~{layout/nav :: nav(activeTab='activities')}"></nav>
<div class="container mx-auto px-6 py-8 grow">
    <!-- content start -->

    <div class="flex items-center justify-between mb-6">
        <div class="flex items-center space-x-2">
            <a th:href="${returnUrl}" class="btn btn-ghost btn-xl">‚Üê</a>
            <h1 class="text-3xl font-bold" th:text="#{activityDetail.pageTitle}"></h1>
        </div>

        <div class="flex gap-2">
            <form th:if="${joinAble}" th:action="@{'/activities/join/' + ${activity.id}}" method="post">
                <button type="submit" class="btn btn-primary btn-md" th:text="#{activityDetail.joinButton}"></button>
            </form>

            <form th:if="${leaveAble}" th:action="@{'/activities/leave/' + ${activity.id}}" method="post">
                <button type="submit" class="btn btn-error btn-md" th:text="#{activityDetail.leaveButton}"></button>
            </form>

            <form th:if="${updateAble}" th:action="@{'/activities/update/' + ${activity.id}}" method="get">
                <button type="submit" class="btn btn-primary btn-md" th:text="#{activityDetail.editButton}"></button>
            </form>

            <form th:if="${deleteAble}" th:action="@{'/activities/delete/' + ${activity.id}}" method="post">
                <button type="submit" class="btn btn-error btn-md" th:text="#{activityDetail.deleteButton}"></button>
            </form>
            <!-- Report Button -->
            <a th:if="${isReportable}" th:href="@{'/reports/create/activity/' + ${activity.id}}" role="tab" class="tab px-2">
                <div class="indicator flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
            </a>
        </div>
    </div>


    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="flex flex-col items-center lg:col-span-1 w-full">

            <div class="w-full h-64 shadow-2xl overflow-hidden rounded-2xl bg-base-100">
                <figure class="w-full h-full rounded-2xl bg-base-100">
                    <img th:if="${activity.image != null}" 
                         th:src="@{${activity.image.url}}" 
                         th:alt="${activity.title}"
                         class="w-full h-full object-cover rounded-2xl"/>
                    <div th:if="${activity.image == null}" 
                         class="w-full h-full bg-gray-200 flex items-center justify-center rounded-2xl">
                        <i class="fas fa-calendar-alt fa-3x text-gray-400"></i>
                    </div>
                </figure>
            </div>


            <div class="w-full bg-base-200 shadow-2xl p-6 rounded-2xl mt-4 flex-1 flex flex-col">
                <p class="text-sm font-semibold text-base-content/70 mb-2" th:text="#{activityDetail.participants}"></p>

                <div class="p-4 rounded-xl shadow-sm flex items-center gap-3 mb-2 border-l-4 border-primary">
                <span th:if="${activity.startedBy.image == null}" class="w-8 h-8 rounded-full bg-gray-400 flex items-center justify-center text-white text-sm font-medium" th:text="${activity.startedBy.initials}"></span>
                    <img th:if="${activity.startedBy.image != null}" th:src="${activity.startedBy.image.url}" alt="Avatar" class="w-8 h-8 rounded-full object-cover ring-2 ring-primary"/>
                    <div class="flex flex-col">
                        <span class="text-xs text-gray-500" th:text="#{activityDetail.starter}"></span>
                        <a th:href="@{'/profile/' + ${activity.startedBy.username}}" class="text-sm font-medium hover:underline" th:text="${activity.startedBy.username}"></a>
                    </div>
                </div>

                <div class="flex-1 overflow-y-auto space-y-2" style="max-height: 300px;">
                    <div th:each="person : ${activity.takePart}" th:if="${person.username != activity.startedBy.username}" class="bg-white p-4 rounded-xl shadow-sm flex items-center gap-3 justify-between">

                        <div class="flex items-center gap-3">
                        <span th:if="${person.image == null}" class="w-8 h-8 rounded-full bg-gray-400 flex items-center justify-center text-white text-sm font-medium" th:text="${person.initials}"></span>
                            <img th:if="${person.image != null}" th:src="${person.image.url}" alt="Avatar" class="w-8 h-8 rounded-full object-cover"/>
                            <div class="flex flex-col">
                                <span class="text-xs text-gray-500" th:text="#{activityDetail.participants}"></span>
                                <a th:href="@{'/profile/' + ${person.username}}" class="text-sm font-medium hover:underline" th:text="${person.username}"></a>
                            </div>
                        </div>

                        <form th:if="${deleteAble}" th:action="@{'/activities/kick/' + ${activity.id} + '/' + ${person.id}}" method="post">
                            <button type="submit" class="btn btn-sm btn-error">Kick</button>
                        </form>

                    </div>
                </div>
            </div>
        </div>




        <div class="lg:col-span-2">
            <div class="card bg-base-200 shadow-2xl p-8 space-y-8 rounded-2xl">

                <div class="flex items-center gap-2">
                    <span class="text-2xl">‚ÑπÔ∏è</span>
                    <h2 class="text-2xl font-bold" th:text="#{activityDetail.pageTitle}"></h2>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-1">
                        <p class="text-sm font-semibold text-base-content/70" th:text="#{activityCreate.title}"></p>
                        <div class="bg-base-100 p-4 rounded-xl shadow-sm">
                            <span class="text-base font-medium" th:text="${activity.title}"></span>
                        </div>
                    </div>

                    <div class="space-y-1">
                        <p class="text-sm font-semibold text-base-content/70" th:text="#{activityCreate.groupSize}"></p>
                        <div class="bg-base-100 p-4 rounded-xl shadow-sm">
                            <span class="text-base font-medium" th:text="${activity.participantStatus}"></span>
                        </div>
                    </div>
                </div>

                <div class="space-y-1">
                    <p class="text-sm font-semibold text-base-content/70" th:text="#{activityCreate.description}"></p>
                    <div class="bg-base-100 p-4 rounded-xl shadow-sm">
                        <span th:text="${activity.description}"></span>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-1">
                        <p class="text-sm font-semibold text-base-content/70" th:text="#{activityCreate.date}"></p>
                        <div class="bg-base-100 p-4 rounded-xl shadow-sm">
                            <span class="text-base font-medium" th:text="${#temporals.format(activity.date, 'dd.MM.yyyy')}"></span>
                        </div>
                    </div>
                    <div class="space-y-1">
                        <p class="text-sm font-semibold text-base-content/70" th:text="#{activityCreate.time}"></p>
                        <div class="bg-base-100 p-4 rounded-xl shadow-sm">
                            <span class="text-base font-medium" th:text="${#temporals.format(activity.date, 'HH:mm')}"></span>
                        </div>
                    </div>
                </div>

                <div class="space-y-1">
                    <p class="text-sm font-semibold text-base-content/70" th:text="#{activityCreate.language}"></p>
                    <div class="bg-base-100 p-4 rounded-xl shadow-sm flex items-center gap-2 text-lg">
                        <span th:text="${activity.language.emoji}"></span>
                        <span th:text="${activity.language.name}"></span>
                    </div>
                </div>

                <div class="space-y-1" th:if="${!#lists.isEmpty(activity.tags)}">
                    <p class="text-sm font-semibold text-base-content/70" th:text="#{activityCreate.tags}"></p>
                    <div class="bg-base-100 p-4 rounded-xl shadow-sm flex flex-wrap gap-2 items-center text-lg">
                        <span th:each="tag : ${activity.tags}">
                            <span class="flex items-center gap-1">
                                <span th:text="${tag.emoji}"></span>
                                <span th:text="#{${tag.key}}"></span>
                             </span>
                        </span>
                    </div>
                </div>

            </div>
        </div>

        <div class="lg:col-span-2 h-full">
            <div th:replace="~{fragments/weather :: weatherCard(${weather})}"></div>
        </div>


        <div class="card bg-base-200 shadow-2xl p-8 space-y-8 rounded-2xl">
            <div class="flex items-center gap-2">
                <span class="text-2xl">üìç</span>
                <h2 class="text-2xl font-bold" th:text="#{addressForm.address}"></h2>
            </div>

            <div class="space-y-1">
                <div th:if="!${#strings.isEmpty(activity.address.addition)}" class="bg-base-100 p-4 rounded-xl shadow-sm">
                    <span class="text-base font-medium" th:text="${activity.address.addition}"></span>
                </div>
                <div class="bg-base-100 p-4 rounded-xl shadow-sm">
                    <span class="text-base font-medium" th:text="${activity.address.street} + ' ' + ${activity.address.houseNumber}"></span>
                </div>
                <div class="bg-base-100 p-4 rounded-xl shadow-sm">
                    <span class="text-base font-medium" th:text="${activity.address.postalCode} + ' ' + ${activity.address.city}"></span>
                </div>
                <div th:if="!${#strings.isEmpty(activity.address.country)}" class="bg-base-100 p-4 rounded-xl shadow-sm">
                    <span class="text-base font-medium" th:text="${activity.address.country}"></span>
                </div>
            </div>
        </div>


        <div class="lg:col-span-3 min-h-[300px]">
            <div th:replace="~{fragments/map :: mapDiv}"></div>
            <script th:replace="~{fragments/map :: mapScript(${activity.address.latitude}, ${activity.address.longitude}, ${activity.title})}"></script>
        </div>

    </div>
    <!-- content end -->
</div>
<footer th:insert="~{layout/footer :: footer}"></footer>
</body>
</html>
