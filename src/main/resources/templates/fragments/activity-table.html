<div th:fragment="activityTable(title, activities, pageParam, activeTab, size, sortBy, direction, tag, search, allTags)">

    <div class="bg-base-200 p-4 rounded-2xl shadow-2xl mb-6">
        <form method="get" th:action="@{/activities}" class="flex flex-col lg:flex-row gap-4 lg:items-end justify-between">

            <input type="hidden" name="activeTab" th:value="${activeTab}"/>
            <input type="hidden" th:name="${pageParam}" value="0"/>

            <div class="form-control w-full lg:w-auto flex-grow max-w-md">
                <label class="label py-1">
                    <span class="label-text text-xs font-semibold uppercase text-gray-500" th:text="#{activityTable.search}"></span>
                </label>
                <div class="join w-full">
                    <input type="text" name="search" class="input input-bordered input-sm join-item w-full" th:placeholder="#{activityTable.searchPlaceholder}" th:value="${search}" />
                    <button type="submit" class="btn btn-sm btn-primary join-item">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                    </button>
                </div>
            </div>

            <div class="flex flex-wrap gap-3 items-end">

                <div class="form-control">
                    <label class="label py-1">
                        <span class="label-text text-xs font-semibold uppercase text-gray-500" th:text="#{activityOverview.Tag}"></span>
                    </label>
                    <select name="tag" class="select select-bordered select-sm w-full max-w-xs" onchange="this.form.submit()">
                        <option th:value="all"  th:selected="${tag == null || tag == ''}" th:text="#{activityTable.allTagOption}"></option>
                        <option th:each="t : ${allTags}" th:value="${t.name()}" th:text="${t.emoji != null ? t.emoji + ' ' + t.name() : t.name()}" th:selected="${t == tag}"></option>
                    </select>
                </div>

                <div class="form-control">
                    <label class="label py-1">
                        <span class="label-text text-xs font-semibold uppercase text-gray-500" th:text="#{activityOverview.SortedBy}"></span>
                    </label>
                    <div class="join">
                        <select name="sortBy" class="select select-bordered select-sm join-item" onchange="this.form.submit()">
                            <option value="date" th:selected="${sortBy == 'date'}" th:text="#{activityTable.date}"></option>
                            <option value="title" th:selected="${sortBy == 'title'}" th:text="#{activityTable.title}"></option>
                            <option value="groupSize" th:selected="${sortBy == 'groupSize'}" th:text="#{activityTable.groupSize}"></option>
                        </select>
                        <select name="direction" class="select select-bordered select-sm join-item" onchange="this.form.submit()">
                            <option value="asc" th:selected="${direction == 'asc'}">▲</option>
                            <option value="desc" th:selected="${direction == 'desc'}">▼</option>
                        </select>
                    </div>
                </div>

                <div class="form-control">
                    <label class="label py-1">
                        <span class="label-text text-xs font-semibold uppercase text-gray-500" th:text="#{activityOverview.Show}"></span>
                    </label>
                    <select name="size" class="select select-bordered select-sm" onchange="this.form.submit()">
                        <option value="5" th:selected="${size == 5}">5</option>
                        <option value="10" th:selected="${size == 10}">10</option>
                        <option value="20" th:selected="${size == 20}">20</option>
                        <option value="50" th:selected="${size == 50}">50</option>
                    </select>
                </div>
            </div>
        </form>
    </div>

    <div class="overflow-x-auto rounded-xl shadow-2xl mb-4">
        <table class="table w-full">
            <thead>
            <tr class="bg-base-200">
                <th th:text="#{activityTable.title}"></th>
                <th th:text="#{activityTable.tags}"></th>
                <th th:text="#{activityTable.date}"></th>
                <th th:text="#{activityTable.time}"></th>
                <th th:text="#{activityTable.capacity}"></th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="a : ${activities.content}">
                <td th:text="${a.title}"></td>
                <td><span th:each="tagItem : ${a.tags}" th:text="${tagItem.emoji} + ' '"></span></td>
                <td th:text="${#temporals.format(a.date, 'dd.MM.yyyy')}"></td>
                <td th:text="${a.timeString}"></td>
                <td th:text="${a.participantStatus}"></td>
                <td><a class="btn btn-primary btn-xs" th:href="@{'/activities/' + ${a.id}}" th:text="#{activityTable.details}"></a></td>
            </tr>
            <tr th:if="${activities.empty}">
                <td colspan="6" class="text-center italic text-gray-500" th:text="#{activityTable.noActivities}"></td>
            </tr>
            </tbody>
        </table>
    </div>

    <div th:if="${activities.totalPages > 1}" class="flex justify-center my-4">
        <div class="join shadow-2xl">
            <a class="join-item btn btn-square"
               th:classappend="${activities.first} ? 'btn-disabled'"
               th:href="@{/activities(${pageParam}=0,activeTab=${activeTab},size=${size},sortBy=${sortBy},direction=${direction},tag=${tag},search=${search})}">«</a>
            <a class="join-item btn btn-square"
               th:classappend="${activities.first} ? 'btn-disabled'"
               th:href="@{/activities(${pageParam}=${activities.number - 1},activeTab=${activeTab},size=${size},sortBy=${sortBy},direction=${direction},tag=${tag},search=${search})}">‹</a>

            <th:block th:with="startPage=${T(java.lang.Math).max(0, activities.number - 2)},endPage=${T(java.lang.Math).min(activities.totalPages - 1, activities.number + 2)}">
                <th:block th:each="i : ${#numbers.sequence(startPage, endPage)}">
                    <input class="join-item btn btn-square" type="radio" name="options" th:aria-label="${i + 1}" th:checked="${i == activities.number}" th:classappend="${i == activities.number} ? 'btn-active bg-primary text-white'" th:onclick="|window.location.href='@{/activities((${pageParam})=${i},activeTab=${activeTab},size=${size},sortBy=${sortBy},direction=${direction},tag=${tag},search=${search})}'|"/>
                </th:block>
            </th:block>

            <a class="join-item btn btn-square"
               th:classappend="${activities.last} ? 'btn-disabled'"
               th:href="@{/activities(${pageParam}=${activities.number + 1},activeTab=${activeTab},size=${size},sortBy=${sortBy},direction=${direction},tag=${tag},search=${search})}">›</a>
            <a class="join-item btn btn-square"
               th:classappend="${activities.last} ? 'btn-disabled'"
               th:href="@{/activities(${pageParam}=${activities.totalPages - 1},activeTab=${activeTab},size=${size},sortBy=${sortBy},direction=${direction},tag=${tag},search=${search})}">»</a>
        </div>
    </div>
</div>
